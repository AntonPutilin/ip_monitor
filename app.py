import streamlit as st
import requests

# –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
st.set_page_config(page_title="IP Monitor", page_icon="üåê")
st.title("üåê –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ü—É–±–ª–∏—á–Ω–æ–≥–æ IP-–∞–¥—Ä–µ—Å–∞")

def get_public_ip():
    """–ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –ø—É–±–ª–∏—á–Ω—ã–π IP-–∞–¥—Ä–µ—Å –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞."""
    try:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç IP –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –≤–∏–¥–µ
        response = requests.get("https://api.ipify.org", timeout=5)
        response.raise_for_status()  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—à–∏–±–∫–∏ HTTP
        return response.text.strip()
    except requests.RequestException:
        return "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏"

# --- –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ---

# –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–∏, —á—Ç–æ–±—ã "–ø–æ–º–Ω–∏—Ç—å" –ø—Ä–µ–¥—ã–¥—É—â–∏–π IP
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º, –µ—Å–ª–∏ –µ—â–µ –Ω–µ –±—ã–ª–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
if 'previous_ip' not in st.session_state:
    st.session_state.previous_ip = None

# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π IP
current_ip = get_public_ip()

# –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–µ–∫—É—â–∏–π IP —Å –ø–æ–º–æ—â—å—é –≤–∏–¥–∂–µ—Ç–∞ st.metric
st.metric(label="–¢–µ–∫—É—â–∏–π IP-–∞–¥—Ä–µ—Å", value=current_ip)

# –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º IP –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Å—Å–∏–∏
if st.session_state.previous_ip is not None:
    if current_ip != st.session_state.previous_ip and current_ip != "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏":
        st.success(f"‚úÖ IP-–∞–¥—Ä–µ—Å –∏–∑–º–µ–Ω–∏–ª—Å—è! –ü—Ä–µ–¥—ã–¥—É—â–∏–π –±—ã–ª: {st.session_state.previous_ip}")
    elif current_ip != "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏":
        st.info("‚ÑπÔ∏è IP-–∞–¥—Ä–µ—Å –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è.")

# –û–±–Ω–æ–≤–ª—è–µ–º "–ø—Ä–µ–¥—ã–¥—É—â–∏–π" IP –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–µ—Å—Å–∏–∏ –Ω–∞ —Ç–µ–∫—É—â–∏–π
if current_ip != "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏":
    st.session_state.previous_ip = current_ip

# –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
st.button("üîÑ –û–±–Ω–æ–≤–∏—Ç—å")

# –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
st.caption("–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É '–û–±–Ω–æ–≤–∏—Ç—å', —á—Ç–æ–±—ã –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∏—Ç—å IP-–∞–¥—Ä–µ—Å.")